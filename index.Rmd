---
title: "Interactive Rasters with R"
author: "inSileco Team"
date: "2020/12/15"
output:
  xaringan::moon_reader:
    css: [default, rd.css, rd-font.css, "hygge"]
    lib_dir: assets
    seal: false
    nature:
      highlightStyle: dracula
      countIncrementalSlides: false
      beforeInit: "macros.js"
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  dev = "png",
  fig.width = 5,
  fig.height = 4.5,
  fig.align = 'center',
  width = 120
)
mypar <- list(fg = "#37abc8", bg = "transparent", las = 1)
par(mypar)
# library(icon)
rfa <- function(...) icon::fontawesome(...)
```


class: title-slide, middle


## .font200[`r icon::fontawesome("r-project")`asters]

<br><br>

.instructors[
  .font180[Interactive raster visualization with `r rfa("r-project")`]
  <br><br><br>
  .authors140[David Beauchesne & Kevin Cazelles]
  <br><br>
  `r format(Sys.time(), '%B %d, %Y')`
]

<br><br><br><br>

<img src="img/logoW.png" width="150px"></img>

.instructors[Content under [`r rfa("creative-commons")` `r rfa("creative-commons-by")`](https://creativecommons.org/licenses/by/4.0/) unless othewise specified]




---

class: inverse, center, middle

# Learning objectives

![:custom_hr]()

## .font160[`r rfa("map")`  + `r rfa("r-project")`]


---

# Learning objectives

<br>

1. Understand the benefits of interactive data visualization with `r rfa("r-project")`

--

2. Learn how to produce and share interactive raster visualizations with `r rfa("r-project")`

--

3. Learn how to build interactive dashboards with `r rfa("r-project")`


---

class: inverse, center, middle

# `r rfa("info-circle")` Rationalize

![:custom_hr]()

## Why use `r rfa("r-project")` for interactive data visualization? (~10min)

---

# Interactive visualization

## Interactive data visualization

> Interactive data visualization refers to the use of modern data analysis software that enables users to directly manipulate and explore graphical representations of data.

--

## Why use interactive visualization?

  - Identify trends
  - Observe relationships in data
  - Data storytelling
  - Simplify complex data
  - Share and explore data
  - Get more out of static visualizations!

---

# Interactive visualization

## Javascript

> [JavaScript](https://www.javascript.com/) is a text-based programming language used both on the client-side and server-side that allows you to make web pages interactive.

--

> JavaScript is the modern interactive web

--

- Close to 1.5 million libraries

--

- Requires in depth knowledge of web-based programming, and, if you are a `r rfa("r-project")` user, learning another programming language

---

# Why `r rfa("r-project")`?

<br>

1. `r rfa("r-project")` packages are actively developped for interactive visualization. See the [htmlwidgets for R](https://www.htmlwidgets.org/) web page for examples

--

2. No need to learn a new language

--

3. Efficiently explore outputs from `r rfa("r-project")` analyses

--

4. Share interactive outputs of `r rfa("r-project")` analyses with collaborators in a variety of formats

--

5. For people still using [ArcGIS](www.arcgis.com) or [QGIS](www.qgis.org) solely for visual data exploration: interactive mapping in `r rfa("r-project")` can now - *partly* - address this

---

# Why `r rfa("r-project")`?

## HTML widgets

In `r rfa("r-project")`, HTML widgets are one of two things:

1. The [`htmlwidgets`](https://cran.r-project.org/package=htmlwidgets) package provides a framework for creating R bindings to JavaScript visualization libraries that can be rendered in a variety of formats (*e.g.* RStudio, R Markdown documents, Shiny applications, or standalone web pages).

--

2. A collection of R packages that allow a user to build interactive visualization (*i.e.* tables, charts, maps, networks, etc) through specific JavaScript libraries


---

# Why `r rfa("r-project")`?

## `r rfa("r-project")` packages for interactive mapping

### **Interactive visualization in general**

.pull-left[
- [`plotly`](https://cran.r-project.org/package=plotly) - uses [Plotly.js](https://plotly.com/javascript/)
- [`highcharter`](https://cran.r-project.org/package=highcharter) - uses [Highcharts.js](https://jkunst.com/highcharter/)
]

--

.pull-right[
*Work well with vectorized spatial objects (`sf` and `sp`) in particular. Not so much with rasters yet.*
]

--

### **Interactive mapping in particular**

.pull-left[
- [`leaflet`](https://cran.r-project.org/package=leaflet) `r rfa("check")` - uses [Leaflet.js](https://leafletjs.com/)
]

--

.pull-right[
*Works well with vectors (`sf` and `sp`) and rasters (`raster` and `stars`)*
]

--

### **`r rfa("r-project")` packages expanding `leaflet` capabilities**

  - [`mapview`](https://cran.r-project.org/package=mapview) `r rfa("check")`
  - [`tmap`](https://cran.r-project.org/package=tmap) `r rfa("check")`

---

class: inverse, center, middle

# Interactive raster mapping

![:custom_hr]()

## .font160[`r rfa("map")`  + `r rfa("r-project")`] (1h)

---

# <a href="https://leafletjs.com/"><img src="https://leafletjs.com/docs/images/logo.png" alt="" width="25%"></a>

## JavaScript library

> Leaflet is the leading open-source JavaScript library for mobile-friendly interactive maps. Weighing just about 39 KB of JS, it has all the mapping features most developers ever need.

--

<h3>Examples<sup>*</sup></h3>

- [The New York Times](https://www.nytimes.com/projects/elections/2013/nyc-primary/mayor/map.html)
- [The Washington Post](https://www.washingtonpost.com/sf/local/2013/11/09/washington-a-world-apart/)
- [GitHub](https://github.blog/2013-06-13-there-s-a-map-for-that/)
- [Open Street Map](https://www.openstreetmap.org/#map=11/46.8543/-71.3414)


.font70[
<sup>*</sup>Examples provided in R Studio's [Leaflet for R](https://rstudio.github.io/leaflet/) introduction
]


---

# <a href="https://leafletjs.com/"><img src="https://leafletjs.com/docs/images/logo.png" alt="" width="25%"></a>

## `r rfa("r-project")` package

[`leaflet`](https://cran.r-project.org/package=leaflet) .font90[06/2015 (1.0.0) &nbsp; // &nbsp; 01/2021 (2.0.4.1)]

- The `leaflet` package integrates and controls Leaflet maps through `r rfa("r-project")`

--

### **Features** - .font70[full list [here](https://rstudio.github.io/leaflet/)]

.font90[
- Interactive panning/zooming
- Compose maps using:
  - Map tiles
  - Markers
  - Polygons
  - Lines
  - Rasters
  - Popups
- Embed maps in knitr/R Markdown documents and Shiny apps
- Render spatial objects
]

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Quick map

.pull-left2[
Leaflet map centered on the St. Lawrence

```{r, eval = FALSE}
library(leaflet)
lf <- leaflet() %>%
 setView(lng = -63,
         lat = 48,
         zoom = 5)
 addTiles(group = 'Default')

lf
```

.font70[See [`setView()`](https://www.rdocumentation.org/packages/leaflet/versions/2.0.3/topics/setView) documentation for more options to set map extent.]


]

.pull-right2[
```{r, fig.width = 6, fig.height = 6, echo = FALSE}
library(leaflet)
lf <- leaflet() %>%
 addTiles(group = 'Default') %>%
 setView(lng = -63,
         lat = 48,
         zoom = 5)

lf
```
]


---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## A quick word on pipes

The pipe operator `%>%` is a chained method that lets you pass an intermediate result to the next function. Thus, these two code chunks provide the same output:

.pull-left[
```{r}
# Example with pipe operator
lf <- leaflet() %>%
 setView(lng = -63,
         lat = 48,
         zoom = 5) %>%
 addTiles(group = 'Default')

```
]

.pull-right[
```{r}
# Example without pipe operator
lf <- leaflet()
lf <- setView(map = lf,
              lng = -63,
              lat = 48,
              zoom = 5)
lf <- addTiles(map = lf,
               group = 'Default')
```
]



.font70[`%>%` is similar to the `+` operator used by `ggplot2` and `tmap`]

.font70[See [here](https://www.datacamp.com/community/tutorials/pipe-r-tutorial) for a full description of the history and use of pipes]

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Base maps

.pull-left2[
`addTiles()` uses [OpenStreetMap](https://www.openstreetmap.org/) as default base map.

Use `addProviderTiles()` for other options.

```{r, eval = FALSE}
leaflet() %>%
 setView(lng = -63,
         lat = 48,
         zoom = 5) %>%
 addProviderTiles('Esri.OceanBasemap',
                  group = 'Ocean')
```

.font90[Full provider list [here](http://leaflet-extras.github.io/leaflet-providers/preview/index.html)]
]

.pull-right2[
```{r, fig.width = 6, fig.height = 6, echo = FALSE}
leaflet() %>%
      setView(lng = -63,
              lat = 48,
              zoom = 5) %>%
      addProviderTiles('Esri.OceanBasemap',
                       group = 'Ocean')
```
]

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Multiple base maps

.pull-left2[
Use [`addLayersControl()`](https://www.rdocumentation.org/packages/leaflet/versions/2.0.3/topics/addLayersControl) to toggle base map selection.

.font90[
```{r, eval = FALSE}
lf <-
 lf %>%
 addProviderTiles('Esri.OceanBasemap',
     group = 'Ocean') %>%
 addProviderTiles("OpenTopoMap",
     group = "Topo") %>%

 # Add layer selection
 addLayersControl(
     baseGroups = c('Default','Ocean',
                    'Topo'),
     position = 'topleft')

lf
```

Note that we are adding features to the preexisting `lf` object
]
]

.pull-right2[
```{r, fig.width = 6, fig.height = 6, echo = FALSE}
lf <- lf %>%
 addProviderTiles('Esri.OceanBasemap',
     group = 'Ocean') %>%
 addProviderTiles("OpenTopoMap",
     group = "Topo") %>%

 # Add layer selection
 addLayersControl(
     baseGroups = c('Default','Ocean','Topo'),
     position = 'topleft')

lf
```
]


---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Add rasters

First, get some raster layers from the [`eDrivers`](https://github.com/eDrivers/eDrivers) `r rfa("r-project")` package, which provides data on environmental stressors for the St. Lawrence System.

Let's get data for hypoxia, demersal destructive fisheries (trawl and dredge), and acidification.

```{r, eval = FALSE}
# Install eDrivers
# devtools::install_github('eDrivers/eDrivers')

# Load data from eDrivers
library(eDrivers)
fetchDrivers(drivers = c('Hypoxia','FisheriesDD','Acidification'),
             output = 'data')

# Raster objects from eDrivers class objects
hyp <- Hypoxia[[1]]
fish <- FisheriesDD[[1]]
acid <- Acidification[[1]]
```

.font70[Use `fetchList()` to see all data available in `eDrivers`]

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Add rasters

.pull-left2[

Use [`addRasterImage()`](https://www.rdocumentation.org/packages/leaflet/versions/2.0.3/topics/addRasterImage) to add rasters from `raster` package.

```{r, eval = FALSE}
lf <- lf %>%
 addRasterImage(hyp,group = 'Hyp') %>%
 addRasterImage(fish,group = 'Fish') %>%
 addRasterImage(acid,group = 'Acid') %>%

# Reset layer selection
addLayersControl(
   baseGroups = c('Default','Ocean',
                  'Topo'),
   overlayGroups = c('Hyp','Fish',
                     'Acid'),
   position = 'topleft')

lf
```
]

.pull-right2[
```{r, fig.width = 6, fig.height = 6, echo = FALSE, eval = FALSE}
# Add layers to leaflet map
lf <- lf %>%
 addRasterImage(hyp,group = 'Hyp') %>%
 addRasterImage(fish,group = 'Fish') %>%
 addRasterImage(acid,group = 'Acid') %>%

# Reset layer selection
addLayersControl(
   baseGroups = c('Default','Ocean','Topo'),
   overlayGroups = c('Hyp','Fish','Acid'),
   position = 'topleft')

lf
```
]


---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Add rasters

**A couple warnings:**

- `leaflet` uses the [EPSG:3857](https://spatialreference.org/ref/sr-org/7483/) projection and will convert the layers you add automatically. You may want to reproject your rasters manually to save computing time.

--

- Raster size is limited by default. Use argument `maxBytes` in `addRasterImage()` to change this.

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

## Exporting and sharing

TODO

---

# Package [`leaflet`](https://cran.r-project.org/package=leaflet)

```{r, echo = FALSE}
countdown::countdown(minutes = 20, seconds = 0)
```

<br/>

### `r rfa("star")` Generate a leaflet map with

- Two tile providers (hint: visit [this](http://leaflet-extras.github.io/leaflet-providers/preview/index.html) website)
- Two raster layers of your choice

### `r rfa("star")` `r rfa("star")` Use a custom color palette to render the rasters

### `r rfa("star")` `r rfa("star")` `r rfa("star")` Export as html document


---

# Package [`mapview`](https://cran.r-project.org/package=mapview)

## `r rfa("r-project")` package

[`mapview`](https://cran.r-project.org/package=mapview) .font90[12/2015 (1.0.0) &nbsp; // &nbsp; 08/2020 (2.9.0)]

> `mapview` provides functions to very quickly and conveniently create interactive visualisations of spatial data. It‚Äôs main goal is to fill the gap of quick (not presentation grade) interactive plotting to examine and visually investigate both aspects of spatial data, the geometries and their attributes.


---

# Package [`mapview`](https://cran.r-project.org/package=mapview)

```{r, eval = FALSE, fig.width = 12, fig.height = 6}
mv <- mapview(hyp) + fish + acid
mv
```


---

# Package [`mapview`](https://cran.r-project.org/package=mapview)

```{r, eval = FALSE, fig.width = 12, fig.height = 6}
mapshot(mv, url = 'data/map.html')
```

The interactive map can then be shared with the `html` file and `map_files/` folder


---

# Package [`mapview`](https://cran.r-project.org/package=mapview)

```{r, echo = FALSE}
countdown::countdown(minutes = 10, seconds = 0)
```

<br/>

### `r rfa("star")` Recreate the map you generated before with `leaflet` using `mapview`

### `r rfa("star")` `r rfa("star")` Export it as a `html` file

---

# Package [`tmap`](https://cran.r-project.org/package=tmap)

## `r rfa("r-project")` package

[`tmap`](https://cran.r-project.org/package=tmap) .font90[12/2015 (1.0.0) &nbsp; // &nbsp; 08/2020 (2.9.0)]

- `tmap` creates flexible thematic maps.

--

- We have looked at the static mapping visualization it offers

--

- Now we look at the interactive capabilities


---

# Package [`tmap`](https://cran.r-project.org/package=tmap)

.pull-left[
.font90[
```{r, fig.width = 5.5, fig.height = 5, echo = TRUE, eval = FALSE}
library(tmap)
tmap_mode("plot")
static <- tm_shape(fish) +
          tm_raster(title = "Fisheries")
static
```
]
]

.pull-right[
.font90[
```{r, fig.width = 5.5, fig.height = 5, echo = TRUE, eval = FALSE}
library(tmap)
tmap_mode("view")
inter <- tm_shape(fish) +
         tm_raster(title = "Fisheries")
inter
```
]
]

---

# Package [`tmap`](https://cran.r-project.org/package=tmap)

.pull-left[
.font90[
```{r, fig.width = 5.5, fig.height = 5, echo = TRUE, eval = FALSE}
library(tmap)
tmap_mode("plot")
static <- tm_shape(fish) +
          tm_raster(title = "Fisheries")
static

# Export as png
tmap_save(static,
          filename = "output/Fisheries.png")
```
]
]

.pull-right[
.font90[
```{r, fig.width = 5.5, fig.height = 5, echo = TRUE, eval = FALSE}
library(tmap)
tmap_mode("view")
inter <- tm_shape(fish) +
         tm_raster(title = "Fisheries")
inter

# Export as html
tmap_save(inter,
          filename = "output/Fisheries.html")
```
]
]

---

# Package [`tmap`](https://cran.r-project.org/package=tmap)

## Multiple layers

.pull-left2[
Use `tm_facets()` to include multiple raster layers

```{r, eval = FALSE}
rstack <- stack(hyp, fish, acid)
tmap_mode("view")
tm_shape(rstack) +
  tm_raster(title = c("Hypoxia",
              "Fisheries",
              "Acidification")) +
tm_facets(as.layers = TRUE,
  free.scales.raster = TRUE)

```
]


.pull-right2[
```{r, fig.width = 6, fig.height = 6, echo = FALSE, eval = FALSE}
rstack <- stack(hyp, fish, acid)
tmap_mode("view")
tm_shape(rstack) +
  tm_raster(title = c("Hypoxia",
              "Fisheries",
              "Acidification")) +
tm_facets(as.layers = TRUE,
  free.scales.raster = TRUE)
```
]

---

# Package [`tmap`](https://cran.r-project.org/package=tmap)

```{r, echo = FALSE}
countdown::countdown(minutes = 10, seconds = 0)
```

<br/>

### `r rfa("star")` Recreate the static map you generated before using `tmap` as an interactive map

### `r rfa("star")` `r rfa("star")` Export the interactive map as a `.html` files


---

class: inverse, center, middle

# Interactive data dashboards

![:custom_hr]()

## .font160[~30 min]


---

# Interactive data dashboards

- Data dashboards are information managements tools used to visually display, track, analyze and share related data visualizations and that meet a particular objective. They can be viewed as interactive reports.

--

- Multiple types of dashboards, for example:
  - Operational dashboards
  - Strategic dashboards
  - Analytical dashboards

--

- Can be automatically updated as new data becomes available


---

# Interactive data dashboards in `r rfa("r-project")`

## `r rfa("r-project")` package

[`flexdashboard`](https://cran.r-project.org/package=flexdashboard) .font90[05/2016 (0.2.0) &nbsp; // &nbsp; 06/2020 (0.5.2)]

- Uses [R Markdown](https://rmarkdown.rstudio.com/) to create a grid dashboard that adapts the size of the dashboard components to the containing web page.

--

- Custom layouts based on rows and columns in a R Markdown document

--

- Can contain a wide variety of components:
  - htmlwidgets
  - base
  - lattice
  - grid
  - tabulat data
  - text

---

# Interactive data dashboards in `r rfa("r-project")`


<body>
   <iframe src="https://beta.rstudioconnect.com/jjallaire/htmlwidgets-highcharter/htmlwidgets-highcharter.html#sales-by-category" style="width:100%; height:100%;"></iframe>
</body>


---

# A (very!) quick intro to R Markdown<sup>*</sup>

## R Markdown universe

R Markdown produces dynamic document in a variety of format.

### Opens new possibilities with R:

* make CV, poster & online presentation
* format scientific paper (`rticles`)
* help to document your research through notebook (`bookdown`)
* build an academic blog or website (`blogdown`)

.font70[<sup>*</sup>See [R Markdown](https://rmarkdown.rstudio.com/) documentation for more details and [here](https://insileco.github.io/ResearchDown/) for a more complete presentation]

---

# A (very!) quick intro to R Markdown<sup>*</sup>

## But what's R Markdown?

- ["An authoring framework for data science."](https://rmarkdown.rstudio.com/lesson-1.html) (‚úîÔ∏è)
- [A document format (.Rmd).](https://bookdown.org/yihui/rmarkdown/) (‚úîÔ∏è)
- [An R package named rmarkdown.](https://rmarkdown.rstudio.com/docs/) (‚úîÔ∏è)
- ["A tool for integrating text, code, and results."](https://r4ds.had.co.nz/communicate-intro.html) (‚úîÔ∏è)
- ["A file format for making dynamic documents with R."](https://rmarkdown.rstudio.com/articles_intro.html) (‚úîÔ∏è)
- ["A computational document."](http://radar.oreilly.com/2011/07/wolframs-computational-documen.html) (‚úîÔ∏è)
- [Wizardry.](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/rmarkdown_wizards.png) (üßô)


.font70[<sup>*</sup>See [R Markdown](https://rmarkdown.rstudio.com/) documentation for more details and [here](https://insileco.github.io/ResearchDown/) for a more complete presentation]

---

# A (very!) quick intro to R Markdown<sup>*</sup>

## How does R Markdown work?

.pull-left[
```{r echo=FALSE, out.width="100%"}
knitr::include_graphics("img/Rmdformat.png")
```
]

.pull-right[
- ü§∑
- I press knit, a document appears, and I believe that anything happening in between could be actual magic.
- `knitr` executes the code and converts `.Rmd` to `.md`; Pandoc renders the `.md` file to the output format you want.
]

.font70[<sup>*</sup>See [R Markdown](https://rmarkdown.rstudio.com/) documentation for more details and [here](https://insileco.github.io/ResearchDown/) for a more complete presentation]

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

```{r, eval = FALSE}
library(rmarkdown)
library(flexdashboard)
draft("dashboard.Rmd",
      template = "flex_dashboard",
      package = "flexdashboard")
```

Creates a `.Rmd` document with a dashboard layout

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

.pull-left[
.font70[
````md
---
title: "Untitled"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---


Column {data-width=650}
------------------------------

### Chart A

`r ''`
```r
```

Column {data-width=350}
------------------------------

### Chart B

`r ''`
```r
```

### Chart C

`r ''`
```r
```
````
]
]

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

.pull-left[
.font70[
````md
---
title: "Untitled"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---


Column {data-width=650}
------------------------------

### Chart A

`r ''`
```r
```

Column {data-width=350}
------------------------------

### Chart B

`r ''`
```r
```

### Chart C

`r ''`
```r
```
````
]
]

.pull-right[
.font80[
**Columns** of width X: level 2 markdown header

```md
Column {data-width=X}
---------------------

or

## Column {data-width=X}
```

**Rows**: level 3 markdown header

```md
### Chart name
```

**Charts**: r code chunk

````md
`r ''`
```r
# Viz here
```
````
]
]

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

.pull-left[
.font70[
````md
---
title: "Untitled"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---


Column {data-width=650}
------------------------------

### Chart A

`r ''`
```r
```

Column {data-width=350}
------------------------------

### Chart B

`r ''`
```r
```

### Chart C

`r ''`
```r
```
````
]
]

.pull-right[
<br/>
<img src="img/layout.png" alt="" width="100%">
]

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

Use `rmarkdown::render()` to render `.html` dashboard and visualize the still empty dashboard by opening `dashboard.html` in your web browser.

```r
rmarkdown::render('dashboard.Rmd')
```

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

We will now populate the dashboard with some visual components.

Chart 1: `tmap` interactive map including hypoxia and acidification

````md
### Chart A

```r
tmap_mode('view')
tm_shape(rstack) +
  tm_raster(title = c("Hypoxia",
                      "Acidification")) +
tm_facets(as.layers = TRUE,
  free.scales.raster = TRUE)
```
````

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

We will now populate the dashboard with some visual components.

Chart 2: Overlaid histograms of values for hypoxia and acidification using `plotly`

````md
### Chart B

```r
plot_ly(alpha = 0.6, nbinsx = 30) %>%
  add_histogram(x = values(hyp), name = 'Hypoxia') %>%
  add_histogram(x = values(acid), name = 'Acidification') %>%
  layout(barmode = "overlay")
```
````

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

We will now populate the dashboard with some visual components.

Chart 3: `tmap` interactive map of the sum of hypoxia and acidification

````md
### Chart C

```r
s <- sum(rstack, na.rm = TRUE)
s[is.na(values(acid))] <- NA
tm_shape(s) +
 tm_raster(title = "Cumulative exposure")
```
````

---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 2, seconds = 0)
```

Render the now populated dashboard and visualize it by opening `dashboard.html` in your web browser.

```r
rmarkdown::render('dashboard.Rmd')
```


---

# Package [`flexdashboard`](https://cran.r-project.org/package=flexdashboard)

```{r, echo = FALSE}
countdown::countdown(minutes = 15, seconds = 0)
```

<br/>


### `r rfa("star")` Create a `flexdashboard` layout with 2 columns and 2 rows

### `r rfa("star")` `r rfa("star")` Include 4 charts of your choice, including at least 2 interactive maps

### `r rfa("star")` `r rfa("star")` `r rfa("star")` Render the dashboard as `.html` document

---

class: inverse, center, middle

# Shiny applications

![:custom_hr]()

## .font160[~30 min]

---

# Shiny applications

- Interactive capabilities thus far limited to base maps, panning, zooming and clicking.

--

- Underlying code remains static with a fixed user interfaces.

--

- Capabilities are limited in terms of user input for controlling interactive content.

--

- In comes Shiny!


---

1. Explain what Shiny is
2. It's components
  3. User interface - front end
  4. Server - back end
  5. Run app
6. `flexdashboard` provides the option of running the dashboard using shiny
7. Recreate same dashboard, but with options to select raster layers and raster operation

---








---

class: inverse, center, middle

# Recap

![:custom_hr]()

---

# Recap

*Tip of the iceberg*

See documentation and resources available for each package for much more options to customize your interactive visualizations:

- [`leaflet`](https://rstudio.github.io/leaflet/)
- [`mapview`](https://r-spatial.github.io/mapview/)
- [`tmap`](https://github.com/mtennekes/tmap)
- [`flexdashboard`](https://rmarkdown.rstudio.com/flexdashboard/index.html)
- [`shiny`](https://shiny.rstudio.com/)

--

Also, keep in mind that although `r rfa("r-project")` packages provide bindings to other languages to make our lives easier, you can also code in the native language:

- [HTML](www.w3schools.com/html): web page
- [CSS](www.w3schools.com/css): style
- [JavaScript](www.w3schools.com/js): interactive content
